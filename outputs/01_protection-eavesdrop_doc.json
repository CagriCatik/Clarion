{
  "thought_process": "Reviewed the markdown and Mermaid diagram. No reserved keywords are used as node IDs. All edge labels are quoted and use the correct `-- \"Label\" -->` syntax. No unclosed markdown blocks or header issues were found. The document flows logically and retains all technical details.",
  "content": "# OTA Eavesdropping Protection – Defense in Depth\n\n## 1. Overview\nThe goal is to preserve confidentiality of firmware, configuration files, and update metadata from the OEM backend to the vehicle even when the communication traverses public or untrusted networks (cellular, Wi‑Fi). An eavesdropper can only observe encrypted blobs; no plaintext firmware or secrets are ever exposed.\n\n## 2. Layered Security Model\n### 2.1 Transport Security (TLS)\n- All OTA traffic uses **TLS 1.2** or **TLS 1.3**.\n- TLS provides:\n  - Encryption of the entire channel.\n  - Server authentication via X.509 certificates.\n- **Mutual TLS** (mTLS) is recommended: both backend and ECU present certificates, preventing MITM and limiting passive monitoring.\n\n### 2.2 Application‑Layer Payload Encryption\n- TLS termination may occur at edge nodes or CDNs (per UN R156, ISO 21434), leaving plaintext vulnerable.\n- Firmware is encrypted **before** entering the distribution network using a symmetric cipher such as **AES‑256‑GCM** or **ChaCha20‑Poly1305**.\n- The symmetric key is never sent in clear; it is encrypted with the ECU’s public key or derived via **ECDH**.\n- Result: even if the TLS tunnel is terminated, the payload remains confidential.\n\n### 2.3 Secure Key Storage & Decryption\n- Private keys reside inside tamper‑resistant hardware:\n  - **HSM**, **TPM**, or **SHE** modules.\n  - Decryption of the symmetric key and the firmware happens inside this secure enclave.\n- Plaintext firmware never touches the main OS memory, thwarting extraction attempts.\n\n## 3. End‑to‑End OTA Flow\nThe following diagram illustrates the complete protected OTA update sequence.\n\n```mermaid\ngraph TD\n    Start_Node[\"Start OTA Update Process\"]\n    TLS_Transport[\"TLS Transport (TLS 1.2/1.3)\"]\n    Mutual_TLS[\"Mutual TLS (X.509 Certificates)\"]\n    Payload_Enc[\"Application Payload Encryption (AES-256-GCM)\"]\n    Key_Enc[\"Symmetric Key Encrypted with ECU Public Key\"]\n    Transmit[\"Transmit Encrypted Package over TLS\"]\n    Secure_Hardware[\"Secure Hardware (HSM/TPM/SHE)\"]\n    Decrypt_SymKey[\"Decrypt Symmetric Key\"]\n    Decrypt_Firmware[\"Decrypt Firmware\"]\n    Verify[\"Integrity & Authenticity Verification\"]\n    Install[\"Install Firmware\"]\n    Reject[\"Reject Update\"]\n    End_Node[\"End Process\"]\n\n    Start_Node -- \"Initialize OTA\" --> TLS_Transport\n    TLS_Transport -- \"Establish Secure Channel\" --> Mutual_TLS\n    Mutual_TLS -- \"Authenticate Backend & ECU\" --> Payload_Enc\n    Payload_Enc -- \"Encrypt Firmware with Symmetric Key\" --> Key_Enc\n    Key_Enc -- \"Encrypt Symmetric Key with ECU Public Key\" --> Transmit\n    Transmit -- \"Send to ECU\" --> Secure_Hardware\n    Secure_Hardware -- \"Retrieve Private Key & Decrypt Symmetric Key\" --> Decrypt_SymKey\n    Decrypt_SymKey -- \"Obtain Symmetric Key\" --> Decrypt_Firmware\n    Decrypt_Firmware -- \"Decrypt Firmware Image\" --> Verify\n    Verify -- \"Pass\" --> Install\n    Verify -- \"Fail\" --> Reject\n    Install --> End_Node\n    Reject --> End_Node\n```\n\n### 3.1 Detailed Step Description\n1. **Backend** generates a random symmetric key and encrypts the firmware image.\n2. The symmetric key is encrypted with the target ECU’s public key (or via ECDH).\n3. Both encrypted blobs are sent over a **TLS‑protected** channel (optionally mTLS).\n4. The ECU receives the package and, within its **secure hardware**, uses the stored private key to recover the symmetric key.\n5. The firmware is decrypted, authenticated, and, if valid, the ECU signals readiness for installation.\n6. Any verification failure aborts the update, ensuring that malformed or tampered data never reaches the vehicle.\n\n## 4. Security Guarantees\n- **Confidentiality**: Data is encrypted at transport and payload layers.\n- **Integrity & Authenticity**: TLS and AEAD ciphers provide tamper detection; hardware verification adds an extra layer.\n- **Key Protection**: Private keys never leave the secure element, mitigating extraction attacks.\n- **Resilience to TLS Termination**: Even if the TLS tunnel ends at an edge node, the payload remains encrypted.\n\n---\n*References*: UN R156, ISO 21434, TLS 1.2/1.3 specifications, NIST SP 800‑38D (AES‑GCM), NIST SP 800‑185 (ChaCha20‑Poly1305)."
}