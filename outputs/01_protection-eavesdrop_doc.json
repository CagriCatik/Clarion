{
  "thought_process": "Reviewed the markdown for structural issues and Mermaid syntax. Found no broken headers or unclosed blocks. Mermaid graph already uses quoted labels for nodes and edge labels, which is correct. Added a blank line before the Mermaid block for clarity and ensured consistent spacing throughout the document.",
  "content": "# OTA Update Confidentiality – Defense in Depth\n\n## Overview\nAn over‑the‑air (OTA) update must remain confidential from the OEM backend all the way to the vehicle ECU.  Eavesdropping attacks are passive: an adversary can capture packets on cellular, Wi‑Fi, or any untrusted network, but cannot modify them.  To thwart such attacks we employ **multiple, complementary layers**:\n\n1. **Transport security (TLS 1.2/1.3, optionally mutual TLS).**\n2. **Application‑layer payload encryption (AES‑256‑GCM or ChaCha20‑Poly1305).**\n3. **Secure hardware key protection on the vehicle (HSM/TPM/SHE).**\n\nIf any single layer is compromised, the remaining layers still protect the firmware and keys.\n\n---\n\n## 1. Transport Security (TLS)\n- All OTA traffic travels over **HTTPS** using TLS 1.2 or TLS 1.3.\n- The server presents an X.509 certificate, authenticating the backend.\n- **Mutual TLS** can be enabled so the ECU also presents a certificate, preventing man‑in‑the‑middle attacks and ensuring the vehicle talks to the legitimate backend.\n- TLS encrypts the whole channel, so a passive observer only sees ciphertext blobs.\n\n> **Note:** Standards such as **UN R156** and **ISO 21434** assume TLS may be terminated at edge nodes or CDNs, so we cannot rely on TLS alone for confidentiality.\n\n---\n\n## 2. Application‑Layer Payload Encryption\n1. The backend generates a **random symmetric key**.\n2. Firmware (or configuration files) is encrypted with this key using an **AEAD cipher** (AES‑256‑GCM or ChaCha20‑Poly1305) to provide confidentiality *and* integrity.\n3. The symmetric key is never sent in clear. It is wrapped with the target ECU’s **public key** (e.g., RSA‑OAEP or ECIES) or derived via an **ECDH** key‑exchange.\n4. Both the **encrypted firmware** and the **encrypted symmetric key** are sent over the TLS channel.\n\nEven if TLS is terminated, the payload remains encrypted and unusable without the ECU’s private key.\n\n---\n\n## 3. Secure Hardware Key Protection on the Vehicle\n- The ECU’s **private key** resides inside a tamper‑resistant module (HSM, TPM, or Secure Hardware Extension).\n- Decryption of the wrapped symmetric key occurs **inside** this secure environment; the private key never leaves the hardware.\n- The symmetric key is then used to decrypt the firmware **inside** the same protected area, ensuring that plaintext firmware never appears in the main OS memory.\n- If any decryption or integrity check fails, the update is rejected.\n\n---\n\n## End‑to‑End Flow\n1. **Backend** creates a symmetric key and encrypts the firmware.\n2. The symmetric key is wrapped with the ECU’s public key.\n3. Both encrypted artifacts travel over a **TLS** tunnel to the vehicle.\n4. The ECU receives the package, forwards the wrapped key to its **secure hardware**.\n5. Secure hardware unwraps the symmetric key, then decrypts the firmware.\n6. Upon successful verification, the ECU signals readiness for installation.\n\nThe diagram below visualises this layered process.\n\n```mermaid\ngraph TD\n    backend[\"Backend (OEM)\"]\n    tls_tunnel[\"TLS 1.2/1.3\\n(mTLS)\"]\n    vehicle_ecu[\"Vehicle ECU\"]\n    secure_hw[\"Secure HW\\n(HSM/TPM)\"]\n    sym_key_enc[\"Encrypted Symmetric Key\"]\n    firmware_enc[\"Encrypted Firmware\"]\n    sym_key[\"Symmetric Key (AES-256-GCM)\"]\n    firmware[\"Firmware Image\"]\n\n    backend --> tls_tunnel --> vehicle_ecu\n    backend -- \"Encrypt Firmware with SymKey\" --> firmware_enc\n    backend -- \"Encrypt SymKey with ECU PubKey\" --> sym_key_enc\n    vehicle_ecu -- \"Receive package over TLS\" --> sym_key_enc\n    vehicle_ecu -- \"Receive package over TLS\" --> firmware_enc\n    vehicle_ecu --> secure_hw\n    secure_hw -- \"Decrypt SymKey (private key inside HW)\" --> sym_key\n    sym_key -- \"Decrypt Firmware\" --> firmware\n    firmware -- \"Validate & Install\" --> vehicle_ecu\n```\n\n---\n\n## Key Takeaways\n- **TLS** protects the communication pipe, but we assume it can be terminated.\n- **Application‑layer encryption** guarantees that the firmware remains confidential even after TLS termination.\n- **Secure hardware** ensures that private keys and plaintext firmware never leave a protected environment, thwarting extraction attacks.\n- The combination of these layers provides **defense‑in‑depth**, making eavesdropping ineffective against OTA updates."
}